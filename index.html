import pygame
import random

# Initialize pygame
pygame.init()

# Define colors
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)
RED = (255, 0, 0)

# Screen dimensions
WIDTH, HEIGHT = 800, 600
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("Jumping Game")

# Game variables
player_width, player_height = 50, 50
player_x = 100
player_y = HEIGHT - player_height - 50
player_vel = 0  # vertical velocity
gravity = 1
jump_strength = -15
on_ground = True

obstacle_width, obstacle_height = 50, 50
obstacle_vel = 5
obstacles = []

# Font
font = pygame.font.SysFont('arial', 32)

# Game clock
clock = pygame.time.Clock()

def create_obstacle():
    """Generate a new obstacle at a random position."""
    obstacle_x = WIDTH
    obstacle_y = HEIGHT - obstacle_height - 50
    obstacles.append(pygame.Rect(obstacle_x, obstacle_y, obstacle_width, obstacle_height))

def draw_player():
    """Draw the player on the screen."""
    pygame.draw.rect(screen, RED, (player_x, player_y, player_width, player_height))

def draw_obstacles():
    """Draw all obstacles on the screen."""
    for obs in obstacles:
        pygame.draw.rect(screen, BLACK, obs)

def move_obstacles():
    """Move obstacles and remove those that go off-screen."""
    global obstacles
    for obs in obstacles:
        obs.x -= obstacle_vel
    obstacles = [obs for obs in obstacles if obs.x + obstacle_width > 0]

def check_collision():
    """Check for collisions between the player and obstacles."""
    player_rect = pygame.Rect(player_x, player_y, player_width, player_height)
    for obs in obstacles:
        if player_rect.colliderect(obs):
            return True
    return False

def main():
    global player_y, player_vel, on_ground, obstacles

    run = True
    score = 0

    while run:
        clock.tick(60)  # Limit the frame rate to 60 FPS

        # Handle events
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                run = False
            if event.type == pygame.KEYDOWN and event.key == pygame.K_SPACE and on_ground:
                # Jump when space bar is pressed
                player_vel = jump_strength
                on_ground = False

        # Update player position
        player_vel += gravity  # Apply gravity
        player_y += player_vel

        if player_y >= HEIGHT - player_height - 50:
            player_y = HEIGHT - player_height - 50
            on_ground = True
            player_vel = 0  # Reset vertical velocity

        # Move obstacles
        move_obstacles()

        # Check for collisions
        if check_collision():
            run = False

        # Generate obstacles randomly
        if random.randint(1, 100) <= 2:  # 2% chance to spawn an obstacle every frame
            create_obstacle()

        # Clear the screen
        screen.fill(WHITE)

        # Draw the player and obstacles
        draw_player()
        draw_obstacles()

        # Display the score
        score += 1
        score_text = font.render(f"Score: {score}", True, BLACK)
        screen.blit(score_text, (10, 10))

        # Update the display
        pygame.display.update()

    # Game Over
    game_over_text = font.render(f"Game Over! Score: {score}", True, BLACK)
    screen.fill(WHITE)
    screen.blit(game_over_text, (WIDTH // 2 - game_over_text.get_width() // 2, HEIGHT // 2))
    pygame.display.update()
    pygame.time.wait(2000)

    pygame.quit()

if __name__ == "__main__":
    main()
